<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ZTECH Key System</title>
<style>
body { margin:0; min-height:100vh; background:#080808; color:white; font-family:system-ui, monospace; display:flex; flex-direction:column; align-items:center; }
.tabs { margin-top:30px; display:flex; gap:10px; }
.tabs button { padding:10px 18px; border-radius:12px; border:none; background:#111; color:#aaa; }
.tabs button.active { background:white; color:black; }
.tab { width:100%; max-width:420px; margin-top:25px; display:none; }
.delta-box { background:black; border-radius:20px; padding:30px; text-align:center; box-shadow:0 0 0 1px rgba(255,255,255,0.05); }
.delta-text { font-weight:600; margin-bottom:20px; }
.delta-btn { background:white; color:black; border:none; border-radius:16px; padding:14px 24px; font-weight:700; cursor:pointer; }
.delta-btn:disabled { opacity:0.4; }
pre { background:#0d0d0d; border-radius:12px; padding:12px; margin-top:16px; color:#00ff9c; }
input, textarea { width:100%; padding:12px; border-radius:10px; background:#111; border:1px solid #333; color:white; margin-bottom:10px; }
ul { list-style:none; padding:0; }
li { background:#111; padding:10px; border-radius:10px; margin-bottom:8px; display:flex; justify-content:space-between; gap:10px; align-items:center; }
li button { background:red; border:none; color:white; border-radius:8px; padding:4px 8px; }
.status-circle { display:inline-block; width:14px; height:14px; border-radius:50%; margin-left:8px; vertical-align:middle; background-color:gray; }
h1.title { color:white; text-align:center; margin-bottom:20px; }
button { cursor:pointer; }
</style>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

<div class="tabs">
  <button id="genTab" class="active">Generate Key</button>
  <button id="bugTab">Bug Report</button>
  <button id="adminTab">Admin</button>
</div>

<!-- KEY GENERATOR -->
<div id="gen" class="tab" style="display:block;">
  <h1 class="title">ZTECH KEYS</h1>
  <div class="delta-box">
    <p class="delta-text">make a key to get white listed</p>
    <button id="genKey" class="delta-btn">Generate Key</button>
    <pre id="output"></pre>
    <p id="disabledMsg"></p>
  </div>
</div>

<!-- BUG REPORT -->
<div id="bug" class="tab">
  <h2>Submit a Bug</h2>
  <textarea id="bugInput" placeholder="Describe the bug..." rows="4"></textarea>
  <button id="submitBug">Submit</button>
  <p id="bugMsg"></p>
</div>

<!-- ADMIN LOGIN -->
<div id="gate" class="tab">
  <h2>Admin Access</h2>
  <input type="password" id="password" placeholder="Admin password">
  <button id="enter">Enter</button>
  <p id="error"></p>
</div>

<!-- ADMIN PANEL -->
<div id="admin" class="tab">
  <h2>Controls</h2>
  <p>Status: <span id="status"></span> <span id="statusCircle" class="status-circle"></span></p>
  <button id="toggleSystem"></button>

  <h2>Active Keys</h2>
  <button id="selectAllKeys">Select All</button>
  <button id="forceExpireSelected">Force Expire Selected</button>
  <ul id="keyList"></ul>

  <h2>Bug Reports</h2>
  <button id="selectAllBugs">Select All</button>
  <button id="markSeenSelected">Mark Seen Selected</button>
  <button id="deleteSelectedBugs">Delete Selected</button>
  <ul id="bugList"></ul>
</div>

<script>
/* ====== FIREBASE CONFIG (PLACEHOLDER) ====== */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT.firebaseio.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_MSG_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ====== TABS ====== */
const genTab=document.getElementById("genTab"), bugTab=document.getElementById("bugTab"), adminTab=document.getElementById("adminTab");
function show(id){ document.querySelectorAll(".tab").forEach(t=>t.style.display="none"); document.getElementById(id).style.display="block";
  genTab.classList.remove("active"); bugTab.classList.remove("active"); adminTab.classList.remove("active");
  if(id==="gen") genTab.classList.add("active");
  if(id==="bug") bugTab.classList.add("active");
  if(id==="gate"||id==="admin") adminTab.classList.add("active");
}
genTab.onclick=()=>show("gen"); bugTab.onclick=()=>show("bug"); adminTab.onclick=()=>show("gate");

/* ====== GLOBAL ====== */
const ADMIN_PASSWORD="ZXKUHL_KEYS-E2013!";
const output=document.getElementById("output"), disabledMsg=document.getElementById("disabledMsg");
const keyList=document.getElementById("keyList"), bugList=document.getElementById("bugList");
const toggleBtn=document.getElementById("toggleSystem"), statusSpan=document.getElementById("status"), statusCircle=document.getElementById("statusCircle");

/* ====== SYSTEM ====== */
function getSystemEnabled(cb){ db.ref("systemEnabled").once("value").then(snap=>cb(snap.exists()?snap.val():true)); }
function setSystemEnabled(val){ db.ref("systemEnabled").set(val); }

/* ====== GENERATE KEY ====== */
document.getElementById("genKey").onclick=()=>{ 
  getSystemEnabled(enabled=>{
    if(!enabled){ disabledMsg.innerText="Key system is shut down."; return; }
    let n=""; for(let i=0;i<10;i++) n+=Math.floor(Math.random()*10);
    const key="FREE-"+n;
    db.ref("keys").push({key:key,expires:Date.now()+86400000,active:true});
    output.innerText=key;
  });
};

/* ====== BUG REPORT ====== */
document.getElementById("submitBug").onclick=()=>{ 
  const val=document.getElementById("bugInput").value.trim(); if(!val) return;
  db.ref("bugs").push({text:val,seen:false,timestamp:Date.now()});
  document.getElementById("bugInput").value=""; document.getElementById("bugMsg").innerText="Bug submitted!";
  setTimeout(()=>document.getElementById("bugMsg").innerText="",1500);
};

/* ====== ADMIN LOGIN ====== */
document.getElementById("enter").onclick=()=>{ 
  if(document.getElementById("password").value===ADMIN_PASSWORD){ show("admin"); loadAdmin(); } 
  else { document.getElementById("error").innerText="Access denied"; }
};

/* ====== ADMIN FUNCTIONS ====== */
function loadAdmin(){ loadKeys(); loadBugs(); loadStatus(); }

/* --- STATUS --- */
function updateStatusCircle(enabled, keyCount){
  if(!enabled) statusCircle.style.backgroundColor="red";
  else if(keyCount<=10) statusCircle.style.backgroundColor="green";
  else if(keyCount<=30) statusCircle.style.backgroundColor="yellow";
  else statusCircle.style.backgroundColor="red";
}

function loadStatus(){
  db.ref("systemEnabled").on("value",snap=>{
    const enabled=snap.val();
    db.ref("keys").once("value").then(kSnap=>{
      const keysCount=kSnap.exists()?Object.values(kSnap.val()).filter(k=>k.active && k.expires>Date.now()).length:0;
      statusSpan.innerText=enabled?"ON":"SHUT DOWN";
      toggleBtn.innerText=enabled?"Shut Down":"Enable System";
      updateStatusCircle(enabled,keysCount);
    });
  });
  db.ref("keys").on("value",snap=>{
    getSystemEnabled(enabled=>{
      const keysCount=snap.exists()?Object.values(snap.val()).filter(k=>k.active && k.expires>Date.now()).length:0;
      updateStatusCircle(enabled, keysCount);
    });
  });
}
toggleBtn.onclick=()=>{ db.ref("systemEnabled").once("value").then(snap=>db.ref("systemEnabled").set(!snap.val())); };

/* --- LOAD KEYS --- */
function loadKeys(){
  keyList.innerHTML="";
  db.ref("keys").on("value",snap=>{
    keyList.innerHTML="";
    if(!snap.exists()) return;
    const val=snap.val();
    Object.keys(val).forEach(id=>{
      const k=val[id]; if(!k.active||k.expires<Date.now()) return;
      const li=document.createElement("li");
      li.innerHTML=`<input type="checkbox" class="expireCheckbox"> ${k.key} âœ… <button>Expire</button>`;
      li.querySelector("button").onclick=()=>{ db.ref("keys/"+id).update({active:false}); };
      keyList.appendChild(li);
    });
  });
}

/* --- FORCE EXPIRE --- */
document.getElementById("forceExpireSelected").onclick=()=>{
  const checkboxes=document.querySelectorAll("#keyList li input.expireCheckbox");
  db.ref("keys").once("value").then(snap=>{
    const keys=snap.val(); if(!keys) return;
    const ids=Object.keys(keys);
    checkboxes.forEach((cb,i)=>{ if(cb.checked) db.ref("keys/"+ids[i]).update({active:false}); });
  });
};

/* --- SELECT ALL --- */
document.getElementById("selectAllKeys").onclick=()=>{ document.querySelectorAll("#keyList li input.expireCheckbox").forEach(cb=>cb.checked=true); };
document.getElementById("selectAllBugs").onclick=()=>{ document.querySelectorAll("#bugList li input.bugCheckbox").forEach(cb=>cb.checked=true); };

/* --- BUGS --- */
function loadBugs(){
  db.ref("bugs").on("value",snap=>{
    bugList.innerHTML="";
    if(!snap.exists()) return;
    const val=snap.val();
    Object.keys(val).forEach(id=>{
      const b=val[id];
      const li=document.createElement("li");
      li.innerHTML=`<input type="checkbox" class="bugCheckbox"> ${b.seen?"(Seen) ":""}${b.text} <button>Mark Seen</button> <button>Delete</button>`;
      li.querySelector("button:nth-of-type(1)").onclick=()=>{ db.ref("bugs/"+id).update({seen:true}); };
      li.querySelector("button:nth-of-type(2)").onclick=()=>{ db.ref("bugs/"+id).remove(); };
      bugList.appendChild(li);
    });
  });
}

/* --- BULK BUG ACTIONS --- */
document.getElementById("markSeenSelected").onclick=()=>{
  const checkboxes=document.querySelectorAll("#bugList li input.bugCheckbox");
  db.ref("bugs").once("value").then(snap=>{
    const bugs=snap.val(); if(!bugs) return;
    const ids=Object.keys(bugs);
    checkboxes.forEach((cb,i)=>{ if(cb.checked) db.ref("bugs/"+ids[i]).update({seen:true}); });
  });
};
document.getElementById("deleteSelectedBugs").onclick=()=>{
  const checkboxes=document.querySelectorAll("#bugList li input.bugCheckbox");
  db.ref("bugs").once("value").then(snap=>{
    const bugs=snap.val(); if(!bugs) return;
    const ids=Object.keys(bugs);
    checkboxes.forEach((cb,i)=>{ if(cb.checked) db.ref("bugs/"+ids[i]).remove(); });
  });
};
</script>
</body>
</html>
