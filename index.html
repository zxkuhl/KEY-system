<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ZTECH Key System</title>
<style>
body { margin:0; min-height:100vh; background:#080808; color:white; font-family:system-ui, monospace; display:flex; flex-direction:column; align-items:center;}
.tabs { margin-top:30px; display:flex; gap:10px; }
.tabs button { padding:10px 18px; border-radius:12px; border:none; background:#111; color:#aaa; cursor:pointer; }
.tabs button.active { background:white; color:black; }
.tab { width:100%; max-width:480px; margin-top:25px; display:none; }
.delta-box { background:black; border-radius:20px; padding:30px; text-align:center; box-shadow:0 0 0 1px rgba(255,255,255,0.05);}
.delta-text { font-weight:600; margin-bottom:20px; }
.delta-btn { background:white; color:black; border:none; border-radius:16px; padding:14px 24px; font-weight:700; cursor:pointer; }
.delta-btn:disabled { opacity:0.4; }
pre { background:#0d0d0d; border-radius:12px; padding:12px; margin-top:16px; color:#00ff9c; }
input, textarea { width:100%; padding:12px; border-radius:10px; background:#111; border:1px solid #333; color:white; margin-bottom:10px; }
ul { list-style:none; padding:0; }
li { background:#111; padding:10px; border-radius:10px; margin-bottom:8px; display:flex; justify-content:space-between; gap:10px; align-items:center; }
li button { background:red; border:none; color:white; border-radius:8px; padding:4px 8px; }
.status-circle { display:inline-block; width:14px; height:14px; border-radius:50%; margin-left:8px; vertical-align:middle; background-color:gray; }
button.selectAll { margin-right:10px; }
h1.title { color:white; text-align:center; margin-bottom:20px; }
</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

<div class="tabs">
  <button id="genTab" class="active">Generate Key</button>
  <button id="bugTab">Bug Report</button>
  <button id="adminTab">Admin</button>
</div>

<!-- Key Generator -->
<div id="gen" class="tab" style="display:block;">
  <h1 class="title">ZTECH KEYS</h1>
  <div class="delta-box">
    <p class="delta-text">make a key to get white listed</p>
    <button id="genKey" class="delta-btn">Generate Key</button>
    <pre id="output"></pre>
    <p id="disabledMsg"></p>
  </div>
</div>

<!-- Bug Report -->
<div id="bug" class="tab">
  <h2>Submit a Bug</h2>
  <textarea id="bugInput" placeholder="Describe the bug..." rows="4"></textarea>
  <button id="submitBug">Submit</button>
  <p id="bugMsg"></p>
</div>

<!-- Admin Gate -->
<div id="gate" class="tab">
  <h2>Admin Access</h2>
  <input type="password" id="password" placeholder="Admin password">
  <button id="enter">Enter</button>
  <p id="error"></p>
</div>

<!-- Admin Panel -->
<div id="admin" class="tab">
  <h2>Controls</h2>
  <p>Status: <span id="status"></span> <span id="statusCircle" class="status-circle"></span></p>
  <button id="toggleSystem"></button>

  <h2>Active Keys</h2>
  <button id="selectAllKeys" class="selectAll">Select All</button>
  <button id="forceExpireSelected" class="selectAll">Force Expire Selected</button>
  <ul id="keyList"></ul>
  <div>
    <button id="prevKeys">Previous</button>
    <span id="keyPage">1</span>
    <button id="nextKeys">Next</button>
  </div>

  <h2>Bug Reports</h2>
  <button id="selectAllBugs" class="selectAll">Select All</button>
  <button id="markSeenSelected" class="selectAll">Mark Seen Selected</button>
  <button id="deleteSelectedBugs" class="selectAll">Delete Selected</button>
  <ul id="bugList"></ul>
  <div>
    <button id="prevBugs">Previous</button>
    <span id="bugPage">1</span>
    <button id="nextBugs">Next</button>
  </div>
</div>

<script>
/* ====== FIREBASE CONFIG ====== */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_DOMAIN.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT.firebaseio.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_BUCKET.appspot.com",
  messagingSenderId: "YOUR_MSG_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ====== TABS ====== */
const genTab = document.getElementById("genTab");
const bugTab = document.getElementById("bugTab");
const adminTab = document.getElementById("adminTab");
function show(id){
  document.querySelectorAll(".tab").forEach(t=>t.style.display="none");
  document.getElementById(id).style.display="block";
  genTab.classList.remove("active"); bugTab.classList.remove("active"); adminTab.classList.remove("active");
  if(id==="gen") genTab.classList.add("active");
  if(id==="bug") bugTab.classList.add("active");
  if(id==="gate"||id==="admin") adminTab.classList.add("active");
}
genTab.onclick=()=>show("gen");
bugTab.onclick=()=>show("bug");
adminTab.onclick=()=>show("gate");

/* ====== GLOBAL ====== */
const ADMIN_PASSWORD="ZXKUHL_KEYS-E2013!";
const output=document.getElementById("output");
const disabledMsg=document.getElementById("disabledMsg");

/* ====== SYSTEM STATE ====== */
function getSystemEnabled(cb){ db.ref("systemEnabled").once("value", snap=>cb(snap.exists()?snap.val():true)); }
function setSystemEnabled(val){ db.ref("systemEnabled").set(val); }

/* ====== KEY GENERATOR ====== */
function generateKey(){ let n=""; for(let i=0;i<10;i++) n+=Math.floor(Math.random()*10); return "FREE-"+n; }
document.getElementById("genKey").onclick=()=>{
  getSystemEnabled(enabled=>{
    if(!enabled){ disabledMsg.innerText="Key system is shut down."; return; }
    const key=generateKey();
    const now=Date.now();
    db.ref("keys").push({key:key,expires:now+86400000,active:true});
    output.innerText=key;
  });
};

/* ====== BUG REPORT ====== */
document.getElementById("submitBug").onclick=()=>{
  const val=document.getElementById("bugInput").value.trim(); if(!val) return;
  db.ref("bugs").push({text:val,seen:false,timestamp:Date.now()});
  document.getElementById("bugInput").value=""; document.getElementById("bugMsg").innerText="Bug submitted!";
  setTimeout(()=>document.getElementById("bugMsg").innerText="",1500);
};

/* ====== ADMIN LOGIN ====== */
document.getElementById("enter").onclick=()=>{
  if(document.getElementById("password").value===ADMIN_PASSWORD){ show("admin"); loadAdmin(); }
  else { document.getElementById("error").innerText="Access denied"; }
};

/* ====== ADMIN PANEL ====== */
const statusSpan=document.getElementById("status");
const statusCircle=document.getElementById("statusCircle");
const toggleBtn=document.getElementById("toggleSystem");
const keyList=document.getElementById("keyList");
const forceBtn=document.getElementById("forceExpireSelected");
const bugList=document.getElementById("bugList");

// Pagination variables
let keyData=[], keyPageIndex=0, keysPerPage=10;
let bugData=[], bugPageIndex=0, bugsPerPage=10;

function loadAdmin(){ loadStatus(); loadKeys(); loadBugs(); }

/* --- STATUS --- */
function loadStatus(){
  db.ref("systemEnabled").on("value", snap=>{
    const val = snap.val() !== null ? snap.val() : true;
    statusSpan.innerText = val?"ON":"SHUT DOWN";
    toggleBtn.innerText = val?"Shut Down":"Enable System";
    // Status circle logic
    db.ref("keys").once("value",kSnap=>{
      const keyCount = kSnap.exists()?Object.keys(kSnap.val()).length:0;
      statusCircle.style.backgroundColor = !val?"red": keyCount<=10?"green": keyCount<=30?"yellow":"red";
    });
  });
}
// Toggle system (admin only)
toggleBtn.onclick=()=>{ getSystemEnabled(enabled=>setSystemEnabled(!enabled)); };

/* --- LOAD KEYS --- */
function loadKeys(){
  db.ref("keys").on("value", snap=>{
    keyData=[]; keyPageIndex=0;
    if(snap.exists()){
      Object.keys(snap.val()).forEach(id=>{
        const k=snap.val()[id];
        if(k.active && k.expires>Date.now()) keyData.push({id,key:k.key});
      });
    }
    renderKeyPage();
  });
}
function renderKeyPage(){
  keyList.innerHTML="";
  const start=keyPageIndex*keysPerPage;
  const pageItems=keyData.slice(start,start+keysPerPage);
  pageItems.forEach(k=>{
    const li=document.createElement("li");
    li.innerHTML=`<input type="checkbox" class="expireCheckbox" data-id="${k.id}"> ${k.key} âœ… <button>Expire</button>`;
    li.querySelector("button").onclick=()=>{ db.ref("keys/"+k.id).update({active:false}); };
    keyList.appendChild(li);
  });
  document.getElementById("keyPage").innerText=keyPageIndex+1;
}
document.getElementById("prevKeys").onclick=()=>{ if(keyPageIndex>0){ keyPageIndex--; renderKeyPage(); } };
document.getElementById("nextKeys").onclick=()=>{ if((keyPageIndex+1)*keysPerPage<keyData.length){ keyPageIndex++; renderKeyPage(); } };
document.getElementById("forceExpireSelected").onclick=()=>{
  document.querySelectorAll("#keyList li input.expireCheckbox:checked").forEach(cb=>{
    const id=cb.dataset.id; if(id) db.ref("keys/"+id).update({active:false});
  });
};
document.getElementById("selectAllKeys").onclick=()=>{ document.querySelectorAll("#keyList li input.expireCheckbox").forEach(cb=>cb.checked=true); };

/* --- LOAD BUGS --- */
function loadBugs(){
  db.ref("bugs").on("value", snap=>{
    bugData=[]; bugPageIndex=0;
    if(snap.exists()){
      Object.keys(snap.val()).forEach(id=>{
        const b=snap.val()[id];
        bugData.push({id,text:b.text,seen:b.seen});
      });
    }
    renderBugPage();
  });
}
function renderBugPage(){
  bugList.innerHTML="";
  const start=bugPageIndex*bugsPerPage;
  const pageItems=bugData.slice(start,start+bugsPerPage);
  pageItems.forEach(b=>{
    const li=document.createElement("li");
    li.innerHTML=`<input type="checkbox" class="bugCheckbox" data-id="${b.id}"> ${b.seen?"(Seen) ":""}${b.text} <button>Mark Seen</button> <button>Delete</button>`;
    li.querySelector("button:nth-of-type(1)").onclick=()=>{ db.ref("bugs/"+b.id).update({seen:true}); };
    li.querySelector("button:nth-of-type(2)").onclick=()=>{ db.ref("bugs/"+b.id).remove(); };
    bugList.appendChild(li);
  });
  document.getElementById("bugPage").innerText=bugPageIndex+1;
}
document.getElementById("prevBugs").onclick=()=>{ if(bugPageIndex>0){ bugPageIndex--; renderBugPage(); } };
document.getElementById("nextBugs").onclick=()=>{ if((bugPageIndex+1)*bugsPerPage<bugData.length){ bugPageIndex++; renderBugPage(); } };
document.getElementById("selectAllBugs").onclick=()=>{ document.querySelectorAll("#bugList li input.bugCheckbox").forEach(cb=>cb.checked=true); };
document.getElementById("markSeenSelected").onclick=()=>{ document.querySelectorAll("#bugList li input.bugCheckbox:checked").forEach(cb=>{ const id=cb.dataset.id; if(id) db.ref("bugs/"+id).update({seen:true}); }); };
document.getElementById("deleteSelectedBugs").onclick=()=>{ document.querySelectorAll("#bugList li input.bugCheckbox:checked").forEach(cb=>{ const id=cb.dataset.id; if(id) db.ref("bugs/"+id).remove(); }); };
</script>
</body>
</html>
