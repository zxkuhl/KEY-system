<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ZTECH Key System</title>
<style>
body { margin:0; min-height:100vh; background:#080808; color:white; font-family:system-ui, monospace; display:flex; flex-direction:column; align-items:center;}
.tabs { margin-top:30px; display:flex; gap:10px; }
.tabs button { padding:10px 18px; border-radius:12px; border:none; background:#111; color:#aaa; cursor:pointer; }
.tabs button.active { background:white; color:black; }
.tab { width:100%; max-width:480px; margin-top:25px; display:none; }
.delta-box { background:black; border-radius:20px; padding:30px; text-align:center; box-shadow:0 0 0 1px rgba(255,255,255,0.05);}
.delta-text { font-weight:600; margin-bottom:20px; }
.delta-btn { background:white; color:black; border:none; border-radius:16px; padding:14px 24px; font-weight:700; cursor:pointer; }
.delta-btn:disabled { opacity:0.4; }
pre { background:#0d0d0d; border-radius:12px; padding:12px; margin-top:16px; color:#00ff9c; overflow:auto; }
input, textarea { width:100%; padding:12px; border-radius:10px; background:#111; border:1px solid #333; color:white; margin-bottom:10px; }
ul { list-style:none; padding:0; }
li { background:#111; padding:10px; border-radius:10px; margin-bottom:8px; display:flex; gap:10px; align-items:center; }
li button { background:red; border:none; color:white; border-radius:8px; padding:4px 8px; }
.status-circle { width:14px; height:14px; border-radius:50%; display:inline-block; margin-left:6px; }
h1 { margin-bottom:20px; }
button.selectAll { margin-right:10px; }
</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

<div class="tabs">
  <button id="genTab" class="active">Generate Key</button>
  <button id="scriptsTab">Scripts</button>
  <button id="bugTab">Bug Report</button>
  <button id="adminTab">Admin</button>
</div>

<!-- GENERATE -->
<div id="gen" class="tab" style="display:block;">
  <h1>ZTECH KEYS</h1>
  <div class="delta-box">
    <p class="delta-text">make a key to get white listed</p>
    <button id="genKey" class="delta-btn">Generate Key</button>
    <pre id="output"></pre>
    <p id="disabledMsg"></p>
  </div>
</div>

<!-- SCRIPTS -->
<div id="scripts" class="tab">
  <h2>Scripts</h2>
  <div class="delta-box">
    <pre>
-- ZTECH Script
loadstring(game:HttpGet("https://example.com/script.lua"))()
    </pre>
  </div>
</div>

<!-- BUG REPORT -->
<div id="bug" class="tab">
  <h2>Submit a Bug</h2>
  <textarea id="bugInput" rows="4"></textarea>
  <button id="submitBug">Submit</button>
  <p id="bugMsg"></p>
</div>

<!-- ADMIN GATE -->
<div id="gate" class="tab">
  <h2>Admin Access</h2>
  <input type="password" id="password" placeholder="Admin password">
  <button id="enter">Enter</button>
  <p id="error"></p>
</div>

<!-- ADMIN PANEL -->
<div id="admin" class="tab">
  <h2>Controls</h2>
  <p>Status: <span id="status"></span> <span id="statusCircle" class="status-circle"></span></p>
  <button id="toggleSystem"></button>

  <h2>Active Keys</h2>
  <button id="selectAllKeys" class="selectAll">Select All</button>
  <button id="forceExpireSelected" class="selectAll">Force Expire Selected</button>
  <button id="deleteSelectedKeys" class="selectAll">Delete Selected</button>
  <ul id="keyList"></ul>

  <h2>Bug Reports</h2>
  <button id="selectAllBugs" class="selectAll">Select All</button>
  <button id="markSeenSelected" class="selectAll">Mark Seen</button>
  <button id="deleteSelectedBugs" class="selectAll">Delete</button>
  <ul id="bugList"></ul>
</div>

<script>
/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "AIzaSyCDYErDzkUObLnPWJUwqOQcceqS2WyUWyM",
  authDomain: "key-system-5efa4.firebaseapp.com",
  databaseURL: "https://key-system-5efa4-default-rtdb.firebaseio.com/",
  projectId: "key-system-5efa4",
  storageBucket: "key-system-5efa4.appspot.com",
  messagingSenderId: "862359412770",
  appId: "1:862359412770:web:f55b9553644b329dfbaa7b"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ================= GLOBAL ================= */
const ADMIN_PASSWORD = "ZXKUHL_KEYS-E2013!";
let adminAuthed = false;

/* ================= TABS ================= */
function show(id){
  document.querySelectorAll(".tab").forEach(t=>t.style.display="none");
  document.getElementById(id).style.display="block";
  genTab.classList.remove("active");
  scriptsTab.classList.remove("active");
  bugTab.classList.remove("active");
  adminTab.classList.remove("active");
  if(id==="gen") genTab.classList.add("active");
  if(id==="scripts") scriptsTab.classList.add("active");
  if(id==="bug") bugTab.classList.add("active");
  if(id==="gate"||id==="admin") adminTab.classList.add("active");
}
genTab.onclick=()=>show("gen");
scriptsTab.onclick=()=>show("scripts");
bugTab.onclick=()=>show("bug");
adminTab.onclick=()=>show(adminAuthed?"admin":"gate");

/* ================= SYSTEM STATE ================= */
const systemRef = db.ref("system/enabled");
const genKeyBtn = document.getElementById("genKey");
const output = document.getElementById("output");
const disabledMsg = document.getElementById("disabledMsg");

systemRef.on("value", snap=>{
  const enabled = snap.val() !== false;
  genKeyBtn.disabled = !enabled;
  disabledMsg.innerText = enabled ? "" : "Key system is shut down.";
  document.getElementById("status").innerText = enabled?"ON":"SHUT DOWN";
  document.getElementById("statusCircle").style.background = enabled?"green":"red";
});

/* ================= KEY GENERATION ================= */
function makeKey(){ return "FREE-" + Math.floor(Math.random()*1e10); }

genKeyBtn.onclick = ()=>{
  const lastGen = localStorage.getItem("lastGen");
  if(lastGen && Date.now() - lastGen < 3600000){
    output.innerText = "You can only generate 1 key per hour.";
    const prevKey = localStorage.getItem("lastKey");
    if(prevKey) output.innerText = prevKey;
    setTimeout(()=>output.innerText="",5000);
    return;
  }
  systemRef.once("value", s=>{
    if(s.val() === false) return;
    const key = makeKey();
    db.ref("keys").push({key, active:true, expires:Date.now()+86400000, device:navigator.userAgent});
    output.innerText = key;
    localStorage.setItem("lastGen", Date.now());
    localStorage.setItem("lastKey", key);
    setTimeout(()=>output.innerText="",5000);
  });
};

/* ================= BUG REPORT ================= */
submitBug.onclick=()=>{
  if(!bugInput.value.trim()) return;
  db.ref("bugs").push({text:bugInput.value, seen:false});
  bugInput.value="";
  bugMsg.innerText="Bug submitted!";
  setTimeout(()=>bugMsg.innerText="",1200);
};

/* ================= ADMIN LOGIN ================= */
enter.onclick=()=>{
  if(password.value===ADMIN_PASSWORD){
    adminAuthed=true;
    show("admin");
    loadAdmin();
  } else error.innerText="Access denied";
};

/* ================= ADMIN ================= */
function loadAdmin(){
  loadKeys();
  loadBugs();
  toggleSystem.onclick=()=>{ systemRef.set(!(genKeyBtn.disabled)); };
}

/* ================= KEYS ================= */
function loadKeys(){
  db.ref("keys").on("value", snap=>{
    keyList.innerHTML="";
    snap.forEach(c=>{
      const k = c.val();
      const id = c.key;
      // auto delete expired keys
      if(Date.now() > k.expires || !k.active){ db.ref("keys/"+id).remove(); return; }
      const li = document.createElement("li");
      li.innerHTML=`<input type="checkbox" data-id="${id}"> ${k.key}`;
      keyList.appendChild(li);
    });
  });
}

selectAllKeys.onclick=()=>document.querySelectorAll("#keyList input").forEach(cb=>cb.checked=true);
forceExpireSelected.onclick()=>document.querySelectorAll("#keyList input:checked").forEach(cb=>db.ref("keys/"+cb.dataset.id).update({active:false}));
deleteSelectedKeys.onclick=()=>document.querySelectorAll("#keyList input:checked").forEach(cb=>db.ref("keys/"+cb.dataset.id).remove());

/* ================= BUGS ================= */
function loadBugs(){
  db.ref("bugs").on("value", snap=>{
    bugList.innerHTML="";
    snap.forEach(c=>{
      const b = c.val();
      const id = c.key;
      const li = document.createElement("li");
      li.innerHTML=`<input type="checkbox" data-id="${id}">${b.seen?"(Seen) ":""}${b.text}`;
      bugList.appendChild(li);
    });
  });
}
selectAllBugs.onclick=()=>document.querySelectorAll("#bugList input").forEach(cb=>cb.checked=true);
markSeenSelected.onclick=()=>document.querySelectorAll("#bugList input:checked").forEach(cb=>db.ref("bugs/"+cb.dataset.id).update({seen:true}));
deleteSelectedBugs.onclick=()=>document.querySelectorAll("#bugList input:checked").forEach(cb=>db.ref("bugs/"+cb.dataset.id).remove());
</script>
</body>
</html>
